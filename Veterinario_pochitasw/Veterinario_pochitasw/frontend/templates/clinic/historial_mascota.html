{% extends 'clinic/base.html' %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-primary">Historial Médico</h2>
            <h4 class="text-muted">{{ mascota.nombre }} ({{ mascota.especie }})</h4>
        </div>
        <a href="{% url 'dashboard_veterinario' %}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left me-2"></i>Volver
        </a>
    </div>

    <!-- Info Mascota -->
    <div class="card mb-4 border-0 shadow-sm">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3"><strong>Dueño:</strong> {{ mascota.cliente.nombre }} {{ mascota.cliente.apellido
                    }}</div>
                <div class="col-md-3"><strong>Raza:</strong> {{ mascota.raza }}</div>
                <div class="col-md-3"><strong>Edad:</strong> {{ mascota.edad_aprox|default:"Desconocida" }} años</div>
                <div class="col-md-3"><strong>Registro:</strong> {{ mascota.fecha_registro|date:"d/m/Y" }}</div>
            </div>
        </div>
    </div>

    <!-- Timeline de Atenciones -->
    <div class="timeline">
        {% for atencion in atenciones %}
        <div class="card mb-3 border-start border-4 border-success shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h5 class="card-title fw-bold text-success">
                        <i class="fa-solid fa-user-doctor me-2"></i>
                        {{ atencion.cita.fecha_hora|date:"d/m/Y H:i" }}
                    </h5>
                    <span class="badge bg-light text-dark border">
                        Dr. {{ atencion.cita.veterinario.nombre|default:"Sin asignar" }}
                    </span>
                </div>
                <hr>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6 class="fw-bold text-secondary">Diagnóstico</h6>
                        <p class="card-text bg-light p-2 rounded">{{ atencion.diagnostico }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold text-secondary">Tratamiento</h6>
                        <p class="card-text bg-light p-2 rounded">{{ atencion.tratamiento }}</p>
                    </div>
                </div>
                {% if atencion.medicamentos %}
                <div class="mt-3">
                    <strong class="text-muted"><i class="fa-solid fa-pills me-1"></i>Medicamentos:</strong>
                    {{ atencion.medicamentos }}
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5 text-muted">
            <i class="fa-solid fa-folder-open fa-3x mb-3"></i>
            <p>No hay registros médicos para esta mascota.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}